<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Login & Sign Up</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Optional: Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-gray-100">
    <div class="min-h-screen flex items-center justify-center">
        <div class="max-w-md w-full bg-white shadow-lg rounded-lg p-6">
            <h2 class="text-2xl font-semibold mb-4 text-center" id="form-title">Sign Up</h2>
            <form id="auth-form">

                <!-- Full Name Field (Sign Up Only) -->
                <div id="fullname-field" class="mb-4">
                    <label for="fullname" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" id="fullname" name="fullname"
                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Enter your full name" />
                    <p class="text-red-500 text-sm mt-1 hidden" id="fullname-error">Full Name is required.</p>
                </div>

                <!-- Username or Email Field -->
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-gray-700"
                        id="username-label">Username</label>
                    <input type="text" id="username" name="username"
                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Enter your username" />
                    <p class="text-red-500 text-sm mt-1 hidden" id="username-error">Username is required.</p>
                </div>

                <!-- Email Field (Sign Up Only) -->
                <div id="email-field" class="mb-4">
                    <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="email" name="email"
                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Enter your email" />
                    <p class="text-red-500 text-sm mt-1 hidden" id="email-error">Valid Email is required.</p>
                </div>

                <!-- Password Field -->
                <div class="mb-4">
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="password" name="password"
                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Enter your password" />
                    <p class="text-red-500 text-sm mt-1 hidden" id="password-error">Password is required.</p>
                </div>

                <!-- Confirm Password Field (Sign Up Only) -->
                <div id="confirm-password-field" class="mb-4">
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-700">Confirm
                        Password</label>
                    <input type="password" id="confirmPassword" name="confirmPassword"
                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Confirm your password" />
                    <p class="text-red-500 text-sm mt-1 hidden" id="confirmPassword-error">Passwords do not match.</p>
                </div>

                <!-- Submit Button -->
                <button type="submit"
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                    Sign Up
                </button>

                <!-- Toggle Between Login and Sign Up -->
                <div class="text-center mt-4">
                    <p id="toggle-text">
                        Already have an account?
                        <button type="button" class="text-blue-600 hover:underline" id="toggle-button">
                            Login
                        </button>
                    </p>
                </div>

            </form>
        </div>
    </div>

    <!-- JavaScript for Form Toggling and Validation -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let isLogin = false; // Track form state

            const formTitle = document.getElementById('form-title');
            var toggleText = document.getElementById('toggle-text');
            var toggleButton = document.getElementById('toggle-button');
            const authForm = document.getElementById('auth-form');

            // Fields
            const fullnameField = document.getElementById('fullname-field');
            const emailField = document.getElementById('email-field');
            const confirmPasswordField = document.getElementById('confirm-password-field');

            // Labels
            const usernameLabel = document.getElementById('username-label');

            // Error Messages
            const fullnameError = document.getElementById('fullname-error');
            const usernameError = document.getElementById('username-error');
            const emailError = document.getElementById('email-error');
            const passwordError = document.getElementById('password-error');
            const confirmPasswordError = document.getElementById('confirmPassword-error');

            // Toggle Form Between Login and Sign Up
            toggleButton.addEventListener('click', () => {
                isLogin = !isLogin;
                if (isLogin) {
                    formTitle.textContent = 'Login';
                    toggleButton.textContent = 'Sign Up';
                    toggleText.innerHTML = "Don't have an account? <button type='button' class='text-blue-600 hover:underline' id='toggle-button'>Sign Up</button>";
                    fullnameField.classList.add('hidden');
                    emailField.classList.add('hidden');
                    confirmPasswordField.classList.add('hidden');
                    toggleButton = document.getElementById('toggle-button');
                    usernameLabel.textContent = 'Username or Email';
                    authForm.querySelector('button[type="submit"]').textContent = 'Login';
                } else {
                    formTitle.textContent = 'Sign Up';
                    toggleButton.textContent = 'Login';
                    toggleText.innerHTML = "Already have an account? <button type='button' class='text-blue-600 hover:underline' id='toggle-button'>Login</button>";
                    toggleButton = document.getElementById('toggle-button');
                    fullnameField.classList.remove('hidden');
                    emailField.classList.remove('hidden');
                    confirmPasswordField.classList.remove('hidden');

                    usernameLabel.textContent = 'Username';
                    authForm.querySelector('button[type="submit"]').textContent = 'Sign Up';
                }

                // Re-attach the toggle button event listener to the new button
                const newToggleButton = document.getElementById('toggle-button');
                newToggleButton.addEventListener('click', toggleButton.click);
            });

            // Handle Form Submission
            authForm.addEventListener('submit', (e) => {
                e.preventDefault();

                // Reset error messages
                fullnameError.classList.add('hidden');
                usernameError.classList.add('hidden');
                emailError.classList.add('hidden');
                passwordError.classList.add('hidden');
                confirmPasswordError.classList.add('hidden');

                // Get form values
                const fullname = document.getElementById('fullname')?.value.trim();
                const username = document.getElementById('username')?.value.trim();
                const email = document.getElementById('email')?.value.trim().toLowerCase();
                const password = document.getElementById('password')?.value;
                const confirmPassword = document.getElementById('confirmPassword')?.value;

                let hasError = false;

                // Validate Full Name (Sign Up Only)
                if (!isLogin && (!fullname || fullname === '')) {
                    fullnameError.textContent = "Full Name is required.";
                    fullnameError.classList.remove('hidden');
                    hasError = true;
                }

                // Validate Username or Email
                if (!username || username === '') {
                    usernameError.textContent = isLogin ? "Username or Email is required." : "Username is required.";
                    usernameError.classList.remove('hidden');
                    hasError = true;
                }

                // Validate Email (Sign Up Only)
                if (!isLogin) {
                    if (!email || email === '') {
                        emailError.textContent = "Email is required.";
                        emailError.classList.remove('hidden');
                        hasError = true;
                    } else if (!validateEmail(email)) {
                        emailError.textContent = "Invalid email format.";
                        emailError.classList.remove('hidden');
                        hasError = true;
                    }
                }

                // Validate Password
                if (!password || password === '') {
                    passwordError.textContent = "Password is required.";
                    passwordError.classList.remove('hidden');
                    hasError = true;
                }

                // Validate Confirm Password (Sign Up Only)
                if (!isLogin) {
                    if (!confirmPassword || confirmPassword === '') {
                        confirmPasswordError.textContent = "Confirm Password is required.";
                        confirmPasswordError.classList.remove('hidden');
                        hasError = true;
                    } else if (password !== confirmPassword) {
                        confirmPasswordError.textContent = "Passwords do not match.";
                        confirmPasswordError.classList.remove('hidden');
                        hasError = true;
                    }
                }

                if (!hasError) {
                    // Prepare data to send to the server
                    const formData = isLogin
                        ? {
                            usernameOrEmail: username,
                            password: password
                        }
                        : {
                            fullName: fullname,
                            username: username,
                            email: email,
                            password: password
                        };

                    // Determine the endpoint based on form state
                    const endpoint = isLogin ? 'http://localhost:5000/api/v1/users/login' : 'http://localhost:5000/api/v1/users/signup';

                    // Send data to the server via Fetch API
                    // console.log(formData);
                    // console.log(endpoint);

                    fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    })
                        .then(async (response) => {
                            const data = await response.json();
                            if (response.ok) {
                                
                                
                                alert('Success! ');

                                authForm.reset();

                            } else {

                                if (data.error) {
                                    alert(data.error);
                                } else {
                                    alert(`Error occurred: ${data.message}`);
                                }
                            }
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                            alert(`Error occurred: ${error}`);
                        });
                }
            });

            // Helper function to validate email format
            function validateEmail(email) {
                const regex = /^\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}\b/;
                return regex.test(email);
            }
        });
    </script>
</body>

</html>