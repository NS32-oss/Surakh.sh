<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Email Verification</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-100">
    <div class="min-h-screen flex items-center justify-center">
      <div class="max-w-md w-full bg-white shadow-lg rounded-lg p-6">
        <h2 class="text-2xl font-semibold mb-4 text-center" id="form-title">
          Sign Up
        </h2>
        <form id="auth-form">
          <!-- Email Field -->
          <div class="mb-4">
            <label for="email" class="block text-sm font-medium text-gray-700"
              >Email</label
            >
            <input
              type="email"
              id="email"
              name="email"
              class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          <button
            type="button"
            onclick="sendOTP()"
            class="w-full bg-blue-500 text-white py-2 rounded-md"
          >
            Send OTP
          </button>

          <!-- OTP Field -->
          <div class="mb-4 mt-4">
            <label for="otp" class="block text-sm font-medium text-gray-700"
              >OTP</label
            >
            <input
              type="text"
              id="otp"
              name="otp"
              class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          <button
            type="button"
            onclick="verifyOTP()"
            class="w-full bg-green-500 text-white py-2 rounded-md"
          >
            Verify OTP
          </button>
        </form>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const email = urlParams.get("email"); // Get email from URL query parameters

        if (email) {
          document.getElementById("email").value = email; // Pre-fill email field
        }
      });

      async function sendOTP() {
        const email = document.getElementById("email").value;
        console.log(email);

        // Check if email is empty
        if (!email) {
          alert("Please enter an email address");
          return;
        }

        const response = await fetch(
          `http://localhost:5000/api/v1/otp/sendOtp`,
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email }),
          }
        );

        if (response.ok) {
          alert("OTP sent successfully");
        } else {
          const errorData = await response.json(); // Get error details from response
          alert(`Failed to send OTP: ${errorData.message || "Unknown error"}`);
        }
      }

      async function verifyOTP() {
        const email = document.getElementById("email").value;
        const otp = document.getElementById("otp").value;

        // Check if email and OTP are not empty
        if (!email || !otp) {
          alert("Please enter both email and OTP");
          return;
        }

        const response = await fetch(
          `http://localhost:5000/api/v1/otp/checkOtp`,
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email, otp }),
          }
        );

        if (response.ok) {
          window.location.href = `http://localhost:5000/login-success?code=200`;
        } else {
          const errorData = await response.json(); // Get error details from response
          alert(`Invalid OTP: ${errorData.message || "Unknown error"}`);
        }
      }
    </script>
  </body>
</html>
